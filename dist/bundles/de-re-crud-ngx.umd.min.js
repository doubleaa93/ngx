!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/forms"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("@de-re-crud/ngx",["exports","@angular/core","@angular/forms","rxjs","@angular/common"],e):e((t["de-re-crud"]=t["de-re-crud"]||{},t["de-re-crud"].ngx={}),t.ng.core,t.ng.forms,t.rxjs,t.ng.common)}(this,function(t,o,i,l,e){"use strict";var n=function(){function t(t){this.viewContainerRef=t}return t.decorators=[{type:o.Directive,args:[{selector:"[deReCrudComponentHost]"}]}],t.ctorParameters=function(){return[{type:o.ViewContainerRef}]},t}(),M=function(){return(M=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function B(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function r(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,s=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(r=s.next()).done;)i.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=s["return"])&&n.call(s)}finally{if(o)throw o.error}}return i}function u(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}var s=function(){function t(){this._cache={}}return t.prototype.register=function(t,e){this._cache[t]=e},t.prototype.get=function(t){var e=this._cache[t];if(!e)throw new Error("Provider '"+t+"' is not registered. Make sure register(name, options) is called in the applicatio root.");return e},t.decorators=[{type:o.Injectable}],t}(),a=function(t){return 0===(t.value||"").trim().length?{required:!0}:null},c=function(){function t(t){this.fb=t}return t.prototype.group=function(t,e,n,r,o){var s,i;void 0===o&&(o={});var a={},c=n[t+"-"+e];try{for(var l=B(c.fields),u=l.next();!u.done;u=l.next()){var p=u.value,h=r[t+"-"+p.field];if("stamp"!==h.type)if("linkedStruct"!==h.type){var d=this.getValidators(p,h),f=o[h.name]||h.initialValue;a[h.name]=[f,d]}else{var m=h,g=m.reference,y=this.array(g.struct,g.block,n,r,o[h.name]);if(!y.value.length&&0<m.minInstances)for(var v=0;v<m.minInstances;v++)y.push(this.group(g.struct,g.block,n,r));a[h.name]=y}}}catch(C){s={error:C}}finally{try{u&&!u.done&&(i=l["return"])&&i.call(l)}finally{if(s)throw s.error}}var b=this.fb.group(a);return b.value||b.patchValue({}),b},t.prototype.array=function(n,r,o,s,t){var i=this;void 0===t&&(t=[]);var a=[];t&&t.length&&t.forEach(function(t){var e=i.group(n,r,o,s,t);a.push(e)});var e=this.fb.array(a);return e.value||e.setValue([]),e},t.prototype.getValidators=function(o,s){return function(t){var e=[],n=t.root,r=t.parent;return r instanceof i.FormGroup&&!o.condition(r.value,n.value)?null:(s.required&&e.push(i.Validators.required,a),s.minLength&&e.push(i.Validators.minLength(s.minLength)),s.maxLength&&e.push(i.Validators.maxLength(s.maxLength)),s.min&&e.push(i.Validators.min(s.min)),s.max&&e.push(i.Validators.max(s.max)),e.length?i.Validators.compose(e)(t):null)}},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:i.FormBuilder}]},t}(),p=function(){function j(t){this.formBuilder=t,this._cache={}}return j.generateId=function(){return Math.random()},j.assignDefaults=function(t){t.headerSize||(t.headerSize=3)},j.parseLabel=function(t){return"string"==typeof t?t:t["short"]},j.parseSchema=function(t){var e,n,r,o,s,i,a,c,l=[],u=[],p=[];try{for(var h=B(t.schema),d=h.next();!d.done;d=h.next()){var f=d.value,m=M({},f,{label:this.parseLabel(f.label),collectionLabel:this.parseLabel(f.label),fields:[],blocks:[]});try{for(var g=B(f.fields),y=g.next();!y.done;y=g.next()){var v=y.value,b=this.parseLabel(v.label),C=M({},v,{label:b,placeholder:v.placeholder||b,struct:f.name});C.reference&&!C.reference.block&&(C.reference.block="default"),u.push(C),m.fields.push(C.name)}}catch(P){r={error:P}}finally{try{y&&!y.done&&(o=g["return"])&&o.call(g)}finally{if(r)throw r.error}}try{for(var I=B(f.blocks),S=I.next();!S.done;S=I.next()){var k=S.value,_=M({},k,{fields:[],struct:f.name});try{for(var x=B(k.fields),R=x.next();!R.done;R=x.next()){var F=R.value;if(F){var E=F.field?F:{field:F},O=void 0;if(E.condition){var w="{"===E.condition[0]?E.condition:"return "+E.condition;O=new Function("value","rootValue",w)}else O=j.defaultConditionFunc;E.condition=O,_.fields.push(E)}}}catch(V){a={error:V}}finally{try{R&&!R.done&&(c=x["return"])&&c.call(x)}finally{if(a)throw a.error}}p.push(_),m.blocks.push(_.name)}}catch(D){s={error:D}}finally{try{S&&!S.done&&(i=I["return"])&&i.call(I)}finally{if(s)throw s.error}}l.push(m)}}catch(N){e={error:N}}finally{try{d&&!d.done&&(n=h["return"])&&n.call(h)}finally{if(e)throw e.error}}return{structs:l,fields:u,blocks:p}},j.prototype.get=function(t){return this._cache[t]},j.prototype.create=function(t,e,n){for(var r;r=j.generateId(),this._cache[r];);j.assignDefaults(t);var o=j.parseSchema(t),s=this.arrayToMap(function(t){return t.name},o.structs),i=this.arrayToMap(function(t){return t.struct+"-"+t.name},o.fields),a=this.arrayToMap(function(t){return t.struct+"-"+t.name},o.blocks),c={id:r,options:t,form:this.formBuilder.group(t.struct,t.block,a,i,e),structs:s,fields:i,blocks:a,submissionErrors:n,onSubmissionErrorsChange:new l.Subject,navigationStack:[],onNavigationChange:new l.Subject,onValueChange:new l.Subject};return this._cache[r]=c},j.prototype.createForm=function(t,e,n){if(this._cache[t]){var r=this._cache[t],o=r.fields,s=r.blocks;return this.formBuilder.group(e,n,s,o)}},j.prototype.update=function(t,e){this._cache[t]&&this._cache[t].form.patchValue(e)},j.prototype.remove=function(t){this._cache[t]&&delete this._cache[t]},j.prototype.clearErrors=function(t,e){this._cache[t]&&(e?delete this._cache[t].submissionErrors[e]:this._cache[t].submissionErrors={},this.pushSubmissionErrorsChange(t))},j.prototype.setErrors=function(t,e){this._cache[t]&&(this._cache[t].submissionErrors=e,this.pushSubmissionErrorsChange(t))},j.prototype.onChange=function(t,e,n,r){if(this._cache[t]){var o=this._cache[t];this.clearErrors(t,e),r&&o.options.changeNotificationType!==r||o.onValueChange.next({fieldPath:e,value:n,formValue:o.form.value})}},j.prototype.pushNavigation=function(t,e,n,r,o){this._cache[t]&&(this._cache[t].navigationStack.push({struct:e,block:n,path:r,parentPath:o}),this.pushNavigationChange(t))},j.prototype.popNavigation=function(t){this._cache[t]&&(this._cache[t].navigationStack.pop(),this.pushNavigationChange(t))},j.prototype.completeNavigation=function(t){this._cache[t]&&this.popNavigation(t)},j.prototype.pushNavigationChange=function(t,e){this._cache[t].onNavigationChange.next(e)},j.prototype.pushSubmissionErrorsChange=function(t){var e=this._cache[t];e.onSubmissionErrorsChange.next(e.submissionErrors)},j.prototype.arrayToMap=function(n,t){return t.reduce(function(t,e){return t[n(e)]=e,t},new Map)},j.defaultConditionFunc=new Function("return true"),j.decorators=[{type:o.Injectable}],j.ctorParameters=function(){return[{type:c}]},j}(),h=function(){function t(t,e,n){var s=this;this.stateService=t,this.componentFactoryResolver=e,this.providerService=n,this.onAdd=function(t){t.stopPropagation(),t.preventDefault();var e=s.control.field.reference,n=s.stateService.createForm(s.control.formId,e.struct,e.block);s.control.value.push(n);var r=s.control.value.controls.indexOf(n),o=s.control.formPath+"."+r;"table"===s.control.layout&&s.stateService.pushNavigation(s.control.formId,e.struct,e.block,o,s.control.formPath),s.control.onChange(null)}}return t.prototype.ngOnInit=function(){this.state=this.stateService.get(this.control.formId),this.render()},t.prototype.ngOnChanges=function(t){t.control&&!t.control.firstChange&&this.updateInputs()},t.prototype.ngOnDestroy=function(){this._componentRef&&(this._componentRef.destroy(),this._componentRef=null)},t.prototype.render=function(){var t;this._componentRef&&(this._componentRef.destroy(),this._componentRef=null);var e=this.providerService.get(this.state.options.provider);switch(this.control.layout){case"inline":t=e.inlineComponent;break;case"table":t=e.tableComponent;break;default:return void console.error(this.control.layout+" layout is not supported.",JSON.stringify(this.control.field))}var n=this.componentHost.viewContainerRef;n.clear();var r=this.componentFactoryResolver.resolveComponentFactory(t);this._componentRef=n.createComponent(r),this.updateInputs()},t.prototype.updateInputs=function(){if(this._componentRef){var t=this._componentRef.instance,e=M({},this.control,{onAdd:this.onAdd}),n=t.control;t.control=e;var r=this._componentRef.instance.ngOnChanges;if(r){var o={previousValue:n,currentValue:e,firstChange:void 0===n,isFirstChange:function(){return o.firstChange}};r.call(t,{control:o})}}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-collection-field-host",template:"<ng-template deReCrudComponentHost></ng-template>"}]}],t.ctorParameters=function(){return[{type:p},{type:o.ComponentFactoryResolver},{type:s}]},t.propDecorators={componentHost:[{type:o.ViewChild,args:[n]}],control:[{type:o.Input}]},t}(),d=function(){function t(t,e,n){var r=this;this.stateService=t,this.componentFactoryResolver=e,this.providerService=n,this._componentRefs=[],this.onFocus=function(){r._valueOnFocus=r.form.root.get(r.formPath).value},this.onBlur=function(){var t=r.form.root.get(r.formPath).value;r._valueOnFocus!==t&&r.stateService.onChange(r.formId,r.formPath,t,"blur")},this.onChange=function(t){var e=r.form.root.get(r.formPath).value;r.stateService.onChange(r.formId,r.formPath,e,t?"change":null)}}return Object.defineProperty(t.prototype,"formPath",{get:function(){var t=this.field.name;if(this.parentPath){var e=this.parentPath;if(this.parentForm instanceof i.FormArray)e+="."+this.parentForm.controls.indexOf(this.form);t=e+"."+t}return t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.state=this.stateService.get(this.formId);var t=this.state.blocks[this.struct+"-"+this.block].fields.find(function(t){return t.field===e.field.name});this.fieldReference=t,this._submissionErrorsChangeSubscription=this.state.onSubmissionErrorsChange.subscribe(function(){e.updateInputs()}),this._formChangeSubscription=this.form.valueChanges.subscribe(function(){e.shouldRender()?e._componentRefs.length?e.updateInputs():e.render():e.destroyRefs()}),this.render()},t.prototype.ngOnChanges=function(t){if(t.formId&&!t.formId.isFirstChange())return this.ngOnDestroy(),void this.ngOnInit();this.updateInputs()},t.prototype.ngOnDestroy=function(){this._submissionErrorsChangeSubscription&&this._submissionErrorsChangeSubscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this.destroyRefs()},t.prototype.destroyRefs=function(){this._componentRefs.length&&(this._componentRefs.forEach(function(t){return t.destroy()}),this._componentRefs=[])},t.prototype.shouldRender=function(){return this.fieldReference&&this.fieldReference.condition(this.form.value,this.state.form.root.value)},t.prototype.render=function(){if(this.destroyRefs(),this.shouldRender()){var t,e=this.providerService.get(this.state.options.provider);switch(this.field.type){case"text":case"integer":case"date":t=e.inputComponent;break;case"boolean":t=e.checkboxComponent;break;case"list":case"foreignKey":t=e.selectComponent;break;case"linkedStruct":t=h;break;default:return void console.error(this.field.type+" control is not supported.",JSON.stringify(this.field))}var n=this.componentHost.viewContainerRef;n.clear();var r=this.componentFactoryResolver.resolveComponentFactory(e.containerComponent),o=this.componentFactoryResolver.resolveComponentFactory(t),s=n.createComponent(o),i=n.createComponent(r,0,undefined,[[s.location.nativeElement]]);this._componentRefs.push(s,i),this.updateInputs()}},t.prototype.updateInputs=function(){var t,e,n,r,o,s;if(!this.shouldRender()||this._componentRefs.length){if(this._componentRefs.length){var i=this.formPath,a={value:this.form.root.get(i),formPath:i,field:this.field,formId:this.formId,submissionErrors:this.state.submissionErrors&&this.state.submissionErrors[i]||[],form:this.form,rendererType:this.mapType(this.field.type),htmlId:this.formId+"-"+i,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange};switch(this.field.type){case"list":case"foreignKey":var c=this.field,l=a;"foreignKey"===this.field.type?l.options=function(){return[]}:l.options=function(){return c.options};break;case"linkedStruct":var u=a,p=this.field,h=p.reference,d=this.state.blocks[this.struct+"-"+this.block].fields.find(function(t){return t.field===p.name}).hints,f=d&&d.block||h.block,m=this.state.blocks[h.struct+"-"+f].fields,g=[];try{for(var y=B(m),v=y.next();!v.done;v=y.next()){var b=v.value,C=this.state.fields[h.struct+"-"+b.field];g.push(C)}}catch(E){t={error:E}}finally{try{v&&!v.done&&(e=y["return"])&&e.call(y)}finally{if(t)throw t.error}}var I=[];try{for(var S=B(u.value.controls),k=S.next();!k.done;k=S.next()){var _=k.value;I.push(_)}}catch(O){n={error:O}}finally{try{k&&!k.done&&(r=S["return"])&&r.call(S)}finally{if(n)throw n.error}}u.stamp={text:a.field.label,headerSize:this.state.options.headerSize},u.canAdd=!p.maxInstances||I.length<p.maxInstances,u.nestedValues=I,u.nestedFields=g,u.layout=d&&d.layout||"inline"}var x=function(t){var e=t.instance,n=e.control;e.control=a;var r=t.instance.ngOnChanges;if(r){var o={previousValue:n,currentValue:a,firstChange:void 0===n,isFirstChange:function(){return o.firstChange}};r.call(e,{control:o})}};try{for(var R=B(this._componentRefs),F=R.next();!F.done;F=R.next()){x(F.value)}}catch(w){o={error:w}}finally{try{F&&!F.done&&(s=R["return"])&&s.call(R)}finally{if(o)throw o.error}}}}else this.render()},t.prototype.mapType=function(t){switch(t){case"integer":return"number";default:return t}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-input-field-host",template:"\n    <ng-template deReCrudComponentHost></ng-template>"}]}],t.ctorParameters=function(){return[{type:p},{type:o.ComponentFactoryResolver},{type:s}]},t.propDecorators={componentHost:[{type:o.ViewChild,args:[n]}],formId:[{type:o.Input}],form:[{type:o.Input}],struct:[{type:o.Input}],block:[{type:o.Input}],field:[{type:o.Input}],parentForm:[{type:o.Input}],parentPath:[{type:o.Input}]},t}(),f=function(){function t(t,e,n){var r=this;this.stateService=t,this.componentFactoryResolver=e,this.providerService=n,this.click=new o.EventEmitter,this.onClick=function(t){r.click.emit(t)}}return t.prototype.ngOnInit=function(){this.state=this.stateService.get(this.formId),this.render()},t.prototype.ngOnChanges=function(t){if(t.formId&&!t.formId.isFirstChange())return this.ngOnDestroy(),void this.ngOnInit();this.updateInputs()},t.prototype.ngOnDestroy=function(){this._componentRef&&(this._componentRef.destroy(),this._componentRef=null)},t.prototype.render=function(){this._componentRef&&(this._componentRef.destroy(),this._componentRef=null);var t=this.providerService.get(this.state.options.provider),e=this.componentHost.viewContainerRef;e.clear();var n=this.componentFactoryResolver.resolveComponentFactory(t.buttonComponent);this._componentRef=e.createComponent(n),this.updateInputs()},t.prototype.updateInputs=function(){if(this._componentRef){var t=this.state,e=t.options,n=e.struct,r=e.submitButtonStyle,o=e.cancelButtonStyle,s=t.structs,i="submit"===this.type,a=null;switch(this.type){case"submit":a=r;break;case"cancel":a=o}var c=a&&a.text||this.text;i&&r&&r.appendSchemaLabel&&(c=c+" "+s[n].label);var l=[];this.state.options.extraButtonClasses&&l.push.apply(l,u(this.state.options.extraButtonClasses)),this.extraClasses&&("string"==typeof this.extraClasses?l.push.apply(l,u(this.extraClasses.split(" "))):l.push.apply(l,u(this.extraClasses))),this._componentRef.instance.button={text:c,extraClasses:l,type:i?"submit":"button",disabled:this.disabled,onClick:this.onClick,"class":a&&a["class"]||undefined}}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-button-host",template:"<ng-template deReCrudComponentHost></ng-template>"}]}],t.ctorParameters=function(){return[{type:p},{type:o.ComponentFactoryResolver},{type:s}]},t.propDecorators={componentHost:[{type:o.ViewChild,args:[n]}],formId:[{type:o.Input}],type:[{type:o.Input}],extraClasses:[{type:o.Input}],text:[{type:o.Input}],disabled:[{type:o.Input}],click:[{type:o.Output}]},t}(),m=function(){function t(t,e,n){this.stateService=t,this.componentFactoryResolver=e,this.providerService=n}return t.prototype.ngOnInit=function(){var e=this;this.state=this.stateService.get(this.formId);var t=this.state.blocks[this.struct+"-"+this.block].fields.find(function(t){return t.field===e.field.name});this.fieldReference=t,this.render()},t.prototype.ngOnChanges=function(t){if(t.formId&&!t.formId.isFirstChange())return this.ngOnDestroy(),void this.ngOnInit();this.updateInputs()},t.prototype.ngOnDestroy=function(){this._componentRef&&(this._componentRef.destroy(),this._componentRef=null)},t.prototype.shouldRender=function(){return this.fieldReference.condition(this.form.value,this.state.form.root.value)},t.prototype.render=function(){if(this._componentRef&&(this._componentRef.destroy(),this._componentRef=null),this.shouldRender()){var t,e=this.providerService.get(this.state.options.provider);switch(this.field.type){case"stamp":t=e.stampComponent;break;default:return void console.error(this.field.type+" control is not supported.",JSON.stringify(this.field))}var n=this.componentHost.viewContainerRef;n.clear();var r=this.componentFactoryResolver.resolveComponentFactory(t);this._componentRef=n.createComponent(r),this.updateInputs()}},t.prototype.updateInputs=function(){if(this._componentRef){var t=this._componentRef.instance,e=this.field,n={text:e.label,headerSize:this.state.options.headerSize};e.hints&&(e.hints.headerSize&&(n.headerSize=e.hints.headerSize),e.hints.displayClassNames&&(n.classes=e.hints.displayClassNames));var r=t.stamp;t.stamp=n;var o=this._componentRef.instance.ngOnChanges;if(o){var s={previousValue:r,currentValue:n,firstChange:void 0===r,isFirstChange:function(){return s.firstChange}};o.call(t,{control:s})}}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-stamp-field-host",template:"<ng-template deReCrudComponentHost></ng-template>"}]}],t.ctorParameters=function(){return[{type:p},{type:o.ComponentFactoryResolver},{type:s}]},t.propDecorators={componentHost:[{type:o.ViewChild,args:[n]}],formId:[{type:o.Input}],form:[{type:o.Input}],struct:[{type:o.Input}],block:[{type:o.Input}],field:[{type:o.Input}]},t}(),g=function(){function t(t){this.stateService=t}return Object.defineProperty(t.prototype,"struct",{get:function(){return this._struct||this.state.options.struct},set:function(t){this._struct=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"block",{get:function(){return this._block||this.state.options.block},set:function(t){this._block=t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.state=this.stateService.get(this.formId)},t.prototype.ngOnChanges=function(t){!t.formId||t.formId.isFirstChange()||this.ngOnInit()},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-form-host",template:'<ng-container *ngFor="let field of fields">\n  <ng-container [ngSwitch]="field.type">\n    <de-re-crud-stamp-field-host\n      *ngSwitchCase="\'stamp\'"\n      [formId]="formId"\n      [form]="form"\n      [field]="field"\n      [struct]="struct"\n      [block]="block">\n    </de-re-crud-stamp-field-host>\n    <de-re-crud-input-field-host\n      *ngSwitchDefault\n      [formId]="formId"\n      [form]="form"\n      [parentPath]="parentPath"\n      [parentForm]="parentForm"\n      [field]="field"\n      [struct]="struct"\n      [block]="block">\n    </de-re-crud-input-field-host>\n  </ng-container>\n</ng-container>\n'}]}],t.ctorParameters=function(){return[{type:p}]},t.propDecorators={formId:[{type:o.Input}],form:[{type:o.Input}],fields:[{type:o.Input}],parentForm:[{type:o.Input}],parentPath:[{type:o.Input}],struct:[{type:o.Input}],block:[{type:o.Input}]},t}(),y=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule,i.ReactiveFormsModule],declarations:[n,d,m,f,h,g],providers:[p,c],exports:[d,m,f,g],entryComponents:[h]}]}],t}(),v=function(){function t(t){this.stateService=t,this.valueChange=new o.EventEmitter,this.submit=new o.EventEmitter,this.cancel=new o.EventEmitter}return Object.defineProperty(t.prototype,"cancelVisible",{get:function(){return!!this.state.navigationStack.length||this._cancelVisible},set:function(t){this._cancelVisible=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"submitEnabled",{get:function(){return!this.submitting&&this.form.valid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cancelEnabled",{get:function(){return!this.submitting},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"struct",{get:function(){var t=this.state.navigationStack,e=t.length;return e?t[e-1].struct:this.state.options.struct},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"block",{get:function(){var t=this.state.navigationStack,e=t.length;return e?t[e-1].block:this.state.options.block},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"form",{get:function(){var t=this.state.navigationStack,e=t.length;return e?this.state.form.get(t[e-1].path):this.state.form},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentPath",{get:function(){var t=this.state.navigationStack,e=t.length;return e?t[e-1].parentPath:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentForm",{get:function(){var t=this.state.navigationStack,e=t.length;return e?this.state.form.get(t[e-1].parentPath):null},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.state=this.stateService.create(this.options,this.value,this.errors),this.update(),this._navigationChangeSubscription=this.state.onNavigationChange.subscribe(function(){e.update()}),this._formChangeSubscription=this.state.onValueChange.subscribe(function(t){e.valueChange.emit(t)})},t.prototype.ngOnChanges=function(t){t.value&&!t.value.firstChange&&this.stateService.update(this.state.id,t.value.currentValue),t.errors&&!t.errors.firstChange&&this.stateService.setErrors(this.state.id,t.errors.currentValue)},t.prototype.ngOnDestroy=function(){this._navigationChangeSubscription&&this._navigationChangeSubscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this.stateService.remove(this.state.id)},t.prototype.update=function(){var t,e,n=this.state,r=n.options,o=n.navigationStack,s=o[o.length-1];s?(t=s.struct,e=s.block):(t=r.struct,e=r.block);var i=this.getBlockFields(t,e);this.fields=i},t.prototype.getBlockFields=function(t,e){var n,r,o=this.state,s=o.blocks,i=o.fields;if(!s||!i)return[];var a=s[t+"-"+e];if(!a)return[];var c=a.fields,l=[];try{for(var u=B(c),p=u.next();!p.done;p=u.next()){var h=p.value;l.push(i[t+"-"+h.field])}}catch(d){n={error:d}}finally{try{p&&!p.done&&(r=u["return"])&&r.call(u)}finally{if(n)throw n.error}}return l},t.prototype.onCancel=function(t){t.stopPropagation(),t.preventDefault(),this.cancelEnabled&&(this.state.navigationStack.length?this.stateService.popNavigation(this.state.id):(this.cancel.emit(),this.state.form.reset()))},t.prototype.onSubmit=function(t){var e=this;t.stopPropagation(),t.preventDefault(),this.submitEnabled&&(this.state.navigationStack.length?this.stateService.completeNavigation(this.state.id):(this.submitting=!0,this.submit.emit({value:this.state.form.value,onComplete:function(t){t?e.stateService.setErrors(e.state.id,t):(e.stateService.clearErrors(e.state.id),e.state.form.reset()),e.submitting=!1}})))},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-form",template:'<form *ngIf="state.form" [formGroup]="state.form">\n  <de-re-crud-form-host [formId]="state.id"\n                        [form]="form"\n                        [struct]="struct"\n                        [block]="block"\n                        [parentPath]="parentPath"\n                        [parentForm]="parentForm"\n                        [fields]="fields">\n  </de-re-crud-form-host>\n  <de-re-crud-button-host type="submit"\n                          [formId]="state.id"\n                          [disabled]="!submitEnabled"\n                          text="Submit"\n                          (click)="onSubmit($event)">\n  </de-re-crud-button-host>\n  <de-re-crud-button-host *ngIf="cancelVisible"\n                          type="cancel"\n                          [formId]="state.id"\n                          [disabled]="!cancelEnabled"\n                          text="Cancel"\n                          (click)="onCancel($event)">\n  </de-re-crud-button-host>\n</form>\n',styles:[""]}]}],t.ctorParameters=function(){return[{type:p}]},t.propDecorators={options:[{type:o.Input}],value:[{type:o.Input}],errors:[{type:o.Input}],valueChange:[{type:o.Output}],submit:[{type:o.Output}],cancel:[{type:o.Output}],cancelVisible:[{type:o.Input}]},t}(),b=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule,y,i.ReactiveFormsModule],declarations:[v],exports:[v]}]}],t}(),C=function(){function t(){}return t.getFormControlIfErrorFound=function(t){var e=t.form.get(t.field.name);return e.errors&&e.touched||t.submissionErrors.length?e:null},t.hasError=function(t){return!!this.getFormControlIfErrorFound(t)},t.getErrors=function(t){var e,n,r=this.getFormControlIfErrorFound(t);if(!r)return null;var o=[],s=[];if(r.errors&&r.touched)try{for(var i=B(Object.keys(r.errors)),a=i.next();!a.done;a=i.next()){var c=a.value,l=this._errorSort[c],u=r.errors[c];void 0===l?s.push({key:c,metadata:u}):o.push({key:c,metadata:u,sort:l})}}catch(p){e={error:p}}finally{try{a&&!a.done&&(n=i["return"])&&n.call(i)}finally{if(e)throw e.error}}return o.sort(function(t){return t.sort}).concat(s).map(this.getErrorMessage).concat(t.submissionErrors)},t.getErrorMessage=function(t){switch(t.key){case"required":return"This field is required.";case"minlength":return"This field must have at least "+t.metadata.requiredLength+" characters.";case"maxlength":return"This field can not exceed "+t.metadata.requiredLength+" characters.";default:return"Validation failed with error: "+t}},t._errorSort=["required"],t}(),I=function(){function t(){}return t.prototype.getClasses=function(){var t=C.hasError(this.control);return{"has-error":t,"has-feedback":t}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-control-container-renderer",template:'<div class="form-group" [ngClass]="getClasses()">\n  <ng-content></ng-content>\n</div>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),S=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule],providers:[s],declarations:[]}]}],t}(),k=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-input-renderer",template:'<ng-container [formGroup]="control.form">\n  <de-re-crud-bootstrap3-label-renderer [control]="control">\n  </de-re-crud-bootstrap3-label-renderer>\n  <input class="form-control"\n         [type]="control.rendererType"\n         [id]="control.htmlId"\n         [name]="control.field.name"\n         [formControlName]="control.field.name"\n         (focus)="control.onFocus($event)"\n         (blur)="control.onBlur($event)"\n         (input)="control.onChange($event)" />\n  <de-re-crud-bootstrap3-help-renderer [control]="control">\n  </de-re-crud-bootstrap3-help-renderer>\n  <de-re-crud-bootstrap3-validation-errors-renderer [control]="control">\n  </de-re-crud-bootstrap3-validation-errors-renderer>\n</ng-container>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),_=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-select-renderer",template:'<ng-container [formGroup]="control.form">\n  <de-re-crud-bootstrap3-label-renderer [control]="control"></de-re-crud-bootstrap3-label-renderer>\n  <select class="form-control"\n          [id]="control.htmlId"\n          [name]="control.field.name"\n          [formControlName]="control.field.name"\n          (focus)="control.onFocus($event)"\n          (blur)="control.onBlur($event)"\n          (change)="control.onChange($event)">\n    <option *ngFor="let option of control.options" [value]="option.value">{{option.label}}</option>\n  </select>\n  <de-re-crud-bootstrap3-help-renderer [control]="control">\n  </de-re-crud-bootstrap3-help-renderer>\n  <de-re-crud-bootstrap3-validation-errors-renderer [control]="control">\n  </de-re-crud-bootstrap3-validation-errors-renderer>\n</ng-container>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),x=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-label-renderer",template:'<label class="control-label" [htmlFor]="control.htmlId">{{control.field.label}}</label>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),R=function(){function t(){}return Object.defineProperty(t.prototype,"classes",{get:function(){var t;return this._classes&&(t=this._classes),this.button.extraClasses&&(t=(t||[]).concat(this.button.extraClasses)),t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.updateClasses()},t.prototype.ngOnChanges=function(t){t.button&&t.button.currentValue.type!==t.button.previousValue.type&&this.updateClasses()},t.prototype.updateClasses=function(){if(this.button["class"])this._classes=[this.button["class"]];else switch(this.button.type){case"submit":this._classes=["btn-primary"];break;default:this._classes=["btn-default"]}},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-button-renderer",template:'<button class="btn" [ngClass]="classes"\n        [type]="button.type"\n        [disabled]="button.disabled"\n        (click)="button.onClick($event)">\n  {{button.text}}\n</button>\n'}]}],t.propDecorators={button:[{type:o.Input}]},t}(),F=function(){function t(){}return t.prototype.getValue=function(t,e){var n=e[t.name];return null==n||void 0===n?"&nbsp;":n},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-table-renderer",template:'<div>\n  <de-re-crud-stamp-renderer [stamp]="control.stamp">\n  </de-re-crud-stamp-renderer>\n  <de-re-crud-button-host\n    [formId]="control.formId"\n    extraClasses="btn-sm"\n    text="Add"\n    (click)="control.onAdd($event)">\n  </de-re-crud-button-host>\n</div>\n\n<div class="table-control-container">\n  <table class="table table-bordered table-condensed">\n    <thead>\n      <tr>\n        <th *ngFor="let field of control.nestedFields">\n          {{field.label}}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr *ngIf="!control.nestedValues.length">\n        <td colspan="100%">None</td>\n      </tr>\n      <tr *ngFor="let form of control.nestedValues">\n        <td *ngFor="let field of control.nestedFields" [innerHtml]="getValue(field, form.value)"></td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n',styles:[".table-control-container{margin-top:10px}"]}]}],t.propDecorators={control:[{type:o.Input}]},t}(),E=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-checkbox-renderer",template:'<ng-container [formGroup]="control.form">\n  <div class="checkbox">\n    <label [htmlFor]="control.htmlId">\n      <input type="checkbox"\n        [id]="control.htmlId"\n        [name]="control.field.name"\n        [formControlName]="control.field.name"\n        (focus)="control.onFocus($event)"\n        (blur)="control.onBlur($event)"\n        (input)="control.onChange($event)" /> {{control.field.label}}\n    </label>\n  </div>\n  <de-re-crud-bootstrap3-help-renderer [control]="control">\n  </de-re-crud-bootstrap3-help-renderer>\n  <de-re-crud-bootstrap3-validation-errors-renderer [control]="control">\n  </de-re-crud-bootstrap3-validation-errors-renderer>\n</ng-container>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),O=function(){function t(){}return t.prototype.hasError=function(){return C.hasError(this.control)},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-help-renderer",template:'<p *ngIf="control.field.help && !hasError()" class="help-block">{{control.field.help}}</p>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),w=function(){function t(){}return t.prototype.hasError=function(){return C.hasError(this.control)},t.prototype.getErrors=function(){return C.getErrors(this.control)},t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-validation-errors-renderer",template:'<ng-container *ngIf="hasError()"\n  [ngTemplateOutlet]="validationErrors"\n  [ngTemplateOutletContext]="{ errors: getErrors() }">\n</ng-container>\n\n<ng-template #validationErrors let-errors="errors">\n  <ng-container>\n    <p *ngFor="let error of errors" class="help-block">\n      {{error}}\n    </p>\n  </ng-container>\n</ng-template>\n'}]}],t.propDecorators={control:[{type:o.Input}]},t}(),P=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-bootstrap3-inline-renderer",template:'<div>\n  <de-re-crud-stamp-renderer [stamp]="control.stamp">\n  </de-re-crud-stamp-renderer>\n  <de-re-crud-button-host\n    *ngIf="control.canAdd"\n    [formId]="control.formId"\n    extraClasses="btn-sm"\n    text="Add"\n    (click)="control.onAdd($event)">\n  </de-re-crud-button-host>\n</div>\n\n<div class="inline-control-container">\n  <span *ngIf="!control.nestedValues.length">None</span>\n  <div *ngFor="let value of control.nestedValues">\n    <de-re-crud-form-host\n      [formId]="control.formId"\n      [form]="value"\n      [parentPath]="control.formPath"\n      [parentForm]="control.value"\n      [fields]="control.nestedFields"\n      [struct]="control.field.reference.struct"\n      [block]="control.field.reference.block">\n    </de-re-crud-form-host>\n  </div>\n</div>\n',styles:[".inline-control-container{margin-top:10px;margin-bottom:10px}"]}]}],t}(),V=function(){function t(){}return t.decorators=[{type:o.Component,args:[{selector:"de-re-crud-stamp-renderer",template:'<ng-container [ngSwitch]="stamp.headerSize">\n  <h1 *ngSwitchCase="1" [ngClass]="stamp.classes">{{stamp.text}}</h1>\n  <h2 *ngSwitchCase="2" [ngClass]="stamp.classes">{{stamp.text}}</h2>\n  <h3 *ngSwitchCase="3" [ngClass]="stamp.classes">{{stamp.text}}</h3>\n  <h4 *ngSwitchCase="4" [ngClass]="stamp.classes">{{stamp.text}}</h4>\n  <h5 *ngSwitchCase="5" [ngClass]="stamp.classes">{{stamp.text}}</h5>\n  <h6 *ngSwitchCase="6" [ngClass]="stamp.classes">{{stamp.text}}</h6>\n  <p *ngSwitchDefault [ngClass]="stamp.classes">{{stamp.text}}</p>\n</ng-container>\n'}]}],t.propDecorators={stamp:[{type:o.Input}]},t}(),D=function(){function t(t){t.register("bootstrap3",{stampComponent:V,containerComponent:I,inputComponent:k,selectComponent:_,buttonComponent:R,tableComponent:F,inlineComponent:P,checkboxComponent:E})}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule,i.ReactiveFormsModule,y,S],declarations:[I,k,_,x,R,P,F,E,O,w,V],entryComponents:[I,k,_,R,P,F,E,V]}]}],t.ctorParameters=function(){return[{type:s}]},t}();t.DeReCrudFormsModule=b,t.Bootstrap3DeReCrudProviderModule=D,t.ɵa=y,t.ɵh=f,t.ɵi=h,t.ɵb=n,t.ɵj=g,t.ɵc=d,t.ɵg=m,t.ɵe=c,t.ɵd=p,t.ɵk=v,t.ɵq=R,t.ɵt=E,t.ɵm=I,t.ɵu=O,t.ɵr=P,t.ɵn=k,t.ɵp=x,t.ɵo=_,t.ɵw=V,t.ɵs=F,t.ɵv=w,t.ɵl=S,t.ɵf=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=de-re-crud-ngx.umd.min.js.map